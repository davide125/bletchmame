# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on:
  push:
    branches: [ master, qt_port ]
  pull_request:
    branches: [ master, qt_port ]

# Defaults
defaults:
  run:
    shell: bash
    
# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: windows-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:

    # Install Qt
    # - name: Install Qt
    #   uses: jurplel/install-qt-action@v2

    # Checks out your repository under $GITHUB_WORKSPACE, so your job can access it
    - name: Checkout Repository
      uses: actions/checkout@v2

    # Checkout Dependent Repository (libexpat)
    - name: Checkout Dependent Repository (libexpat)
      uses: actions/checkout@v2
      with:
        repository: libexpat/libexpat.git
        ref: R_2_2_9
        path: deps/libexpat

    # Build libexpat
    - name: Build libexpat
      run: |
        cmake deps/libexpat/expat -G "MinGW Makefiles" -B deps/libexpat_build
        cd deps/libexpat_build
        mingw32-make
        dir

    # Runs a single command using the runners shell
    - name: Run a one-line script
      run: echo Hello, world!

    # Executes CMake
    - name: Run CMake
      run: |
       cmake . -G "MinGW Makefiles" -DEXPAT_LIBRARY=./deps/libexpat_build/libexpat.dll -DEXPAT_INCLUDE_DIR=./deps/libexpat/expat/lib
